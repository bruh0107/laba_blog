{% extends 'main.html' %}
{% block content %}
{% for post in page_obj %}
  <div class="post">
    <h3>–ê–≤—Ç–æ—Ä: {{ post.author.username|default:"–£–¥–∞–ª—ë–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" }}</h3>
    <p>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: {{ post.created_at|date:"d M Y, H:i" }}</p>
    <p>{{ post.content }}</p>
    <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: {{ post.comments.count }}</p>
    {% for comment in post.comments.all %}
        <p>{{ comment.content }} ‚Äî {{ comment.author.username|default:"–£–¥–∞–ª—ë–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" }}</p>
        {% if comment.author == request.user %}
            <a href="{% url 'blog:edit_comment' comment.id %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</a>
            <a href="{% url 'blog:delete_comment' comment.id %}">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</a>
        {% endif %}
      {% empty %}
      <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç...</p>
    {% endfor %}
    {% if user.is_authenticated %}
        <h5>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h5>
        <form method="post" class="form py-3" action="{% url 'blog:add_comment' post.id %}">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button type="submit" class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
        </form>
    {% else %}
        <p><a href="{% url 'blog:login' %}">–í–æ–π–¥–∏—Ç–µ</a> –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
    {% endif %}
    <form method="post" action="{% url 'blog:like_post' post.id %}">
      {% csrf_token %}
        {% if user.is_authenticated %}
          <button type="submit">
            {% if user in post.likes.all %}
              üëç –õ–∞–π–∫–Ω—É—Ç–æ ({{ post.like_count }})
            {% else %}
              üëç –õ–∞–π–∫–Ω—É—Ç—å ({{ post.like_count }})
            {% endif %}
          </button>
        {% endif %}
    </form>
    {% if post.author == request.user %}
      <a href="{% url 'blog:edit_post' post.id %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
      <a href="{% url 'blog:delete_post' post.id %}">–£–¥–∞–ª–∏—Ç—å</a>
    {% endif %}
  </div>
  <hr>
{% endfor %}

<div class="pagination">
    <div class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; 1</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}
        <span class="current">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">—Å–ª–µ–¥—É—é—â–∞—è</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">–ø–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
        {% endif %}
    </div>
</div>
{% endblock %}